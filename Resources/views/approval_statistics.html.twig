{% extends '@Approval/layout.html.twig' %}

{% block page_title %}{{ 'Approval Statistics'|trans }}{% endblock %}

{% block main %}
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">{{ 'Approval Statistics Report'|trans }}</h3>
        </div>
        <div class="card-body">
            <form method="post" class="form-inline mb-3">
                {{ form_widget(form) }}
                <button type="submit" class="btn btn-primary ml-2">{{ 'Generate Report'|trans }}</button>
            </form>

            {% if statistics is not empty %}
                <div class="table-responsive">
                    <table class="table table-hover dataTable">
                        <thead>
                            <tr>
                                <th>{{ 'User'|trans }}</th>
                                <th class="text-center">{{ 'Unsubmitted'|trans }}</th>
                                <th class="text-center">{{ 'Submitted'|trans }}</th>
                                <th class="text-center">{{ 'Pending'|trans }}</th>
                                <th class="text-center">{{ 'Approved'|trans }}</th>
                                <th class="text-center">{{ 'Denied'|trans }}</th>
                                <th class="text-center">{{ 'Total'|trans }}</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for stat in statistics %}
                                <tr>
                                    <td>
                                        <strong>{{ stat.user.username }}</strong>
                                        {% if stat.user.displayName and stat.user.displayName != stat.user.username %}
                                            <br><small class="text-muted">{{ stat.user.displayName }}</small>
                                        {% endif %}
                                    </td>
                                    <td class="text-center">
                                        {% if stat.unsubmitted > 0 %}
                                            <span class="badge badge-warning">{{ stat.unsubmitted }}</span>
                                        {% else %}
                                            <span class="text-muted">0</span>
                                        {% endif %}
                                    </td>
                                    <td class="text-center">
                                        {% if stat.submitted > 0 %}
                                            <span class="badge badge-info">{{ stat.submitted }}</span>
                                        {% else %}
                                            <span class="text-muted">0</span>
                                        {% endif %}
                                    </td>
                                    <td class="text-center">
                                        {% if stat.pending > 0 %}
                                            <span class="badge badge-primary">{{ stat.pending }}</span>
                                        {% else %}
                                            <span class="text-muted">0</span>
                                        {% endif %}
                                    </td>
                                    <td class="text-center">
                                        {% if stat.approved > 0 %}
                                            <span class="badge badge-success">{{ stat.approved }}</span>
                                        {% else %}
                                            <span class="text-muted">0</span>
                                        {% endif %}
                                    </td>
                                    <td class="text-center">
                                        {% if stat.denied > 0 %}
                                            <span class="badge badge-danger">{{ stat.denied }}</span>
                                        {% else %}
                                            <span class="text-muted">0</span>
                                        {% endif %}
                                    </td>
                                    <td class="text-center">
                                        <strong>{{ stat.total }}</strong>
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                        <tfoot>
                            <tr class="table-info">
                                <td><strong>{{ 'Totals'|trans }}</strong></td>
                                <td class="text-center">
                                    <strong>
                                        {% set total_unsubmitted = 0 %}
                                        {% for stat in statistics %}
                                            {% set total_unsubmitted = total_unsubmitted + stat.unsubmitted %}
                                        {% endfor %}
                                        {{ total_unsubmitted }}
                                    </strong>
                                </td>
                                <td class="text-center">
                                    <strong>
                                        {% set total_submitted = 0 %}
                                        {% for stat in statistics %}
                                            {% set total_submitted = total_submitted + stat.submitted %}
                                        {% endfor %}
                                        {{ total_submitted }}
                                    </strong>
                                </td>
                                <td class="text-center">
                                    <strong>
                                        {% set total_pending = 0 %}
                                        {% for stat in statistics %}
                                            {% set total_pending = total_pending + stat.pending %}
                                        {% endfor %}
                                        {{ total_pending }}
                                    </strong>
                                </td>
                                <td class="text-center">
                                    <strong>
                                        {% set total_approved = 0 %}
                                        {% for stat in statistics %}
                                            {% set total_approved = total_approved + stat.approved %}
                                        {% endfor %}
                                        {{ total_approved }}
                                    </strong>
                                </td>
                                <td class="text-center">
                                    <strong>
                                        {% set total_denied = 0 %}
                                        {% for stat in statistics %}
                                            {% set total_denied = total_denied + stat.denied %}
                                        {% endfor %}
                                        {{ total_denied }}
                                    </strong>
                                </td>
                                <td class="text-center">
                                    <strong>
                                        {% set total_total = 0 %}
                                        {% for stat in statistics %}
                                            {% set total_total = total_total + stat.total %}
                                        {% endfor %}
                                        {{ total_total }}
                                    </strong>
                                </td>
                            </tr>
                        </tfoot>
                    </table>
                </div>

                <div class="mt-3">
                    <small class="text-muted">
                        {{ 'Report generated for date'|trans }}: {{ selectedDate|date('Y-m-d') }}
                    </small>
                </div>
            {% else %}
                <div class="alert alert-info">
                    {{ 'No approval data found for the selected date range.'|trans }}
                </div>
            {% endif %}
        </div>
    </div>
{% endblock %} 